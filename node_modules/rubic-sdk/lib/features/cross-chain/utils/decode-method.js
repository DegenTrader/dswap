"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.MethodDecoder = void 0;
var web3_1 = __importDefault(require("web3"));
var bignumber_js_1 = __importDefault(require("bignumber.js"));
var MethodDecoder = /** @class */ (function () {
    function MethodDecoder() {
    }
    MethodDecoder.decodeMethod = function (abiItem, data) {
        var abiCoder = new web3_1.default().eth.abi;
        var inputs = abiItem.inputs;
        var decoded = abiCoder.decodeParameters(inputs, data.slice(10));
        var decodedData = {
            name: abiItem.name,
            params: []
        };
        for (var i = 0; i < decoded.__length__; i++) {
            var param = decoded[i];
            var parsedParam = param;
            var isUint = inputs[i].type.indexOf('uint') === 0;
            var isInt = inputs[i].type.indexOf('int') === 0;
            var isAddress = inputs[i].type.indexOf('address') === 0;
            if (isUint || isInt) {
                var isArray = Array.isArray(param);
                if (isArray) {
                    parsedParam = param.map(function (val) { return new bignumber_js_1.default(val).toFixed(); });
                }
                else {
                    parsedParam = new bignumber_js_1.default(param).toFixed();
                }
            }
            // Addresses returned by web3 are randomly cased so we need to standardize and lowercase all
            if (isAddress) {
                var isArray = Array.isArray(param);
                if (isArray) {
                    parsedParam = param.map(function (_) { return _.toLowerCase(); });
                }
                else {
                    parsedParam = param.toLowerCase();
                }
            }
            decodedData.params.push({
                name: inputs[i].name,
                value: parsedParam,
                type: inputs[i].type
            });
        }
        return decodedData;
    };
    return MethodDecoder;
}());
exports.MethodDecoder = MethodDecoder;
//# sourceMappingURL=decode-method.js.map